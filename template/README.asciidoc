= AsciiDoc Template with Conditional Rendering
:filename: README
:def-github-repo: asciidoc-examples
:def-github-branch: main
:def-org: Virtual Space and Global Communications Research
:def-year: 2025
:def-author: Sean Donnellan
:def-classification: Confidential
:def-github-url: github.com
:def-github-user: donnels
:def-github-pages-url: https://{def-github-user}.{def-github-url}/{def-github-repo}
:def-github-repo-url: https://{def-github-url}/{def-github-user}/{def-github-repo}
:toc: right
:toclevels: 5
:sectnums:
:sectnumlevels: 5
:flag-doc: true
:localdir: ./
:imagesdir: ./images/
:data-uri:
include::./includes/book-head-formatting.adoc[]

== Introduction

Start with the wiring diagram. It shows how attributes gate every include.

image::asciidoc-logic.png[]

== AIM
Spell out the template rules.
- Read well on GitHub.
- Export cleanly to HTML and PDF.
- Let every section and subsection build alone or inside the full book.

== Conditional Rendering Flags

Three flags drive everything:
- `:flag-doc:` tells the root it owns the render.
- `:flag-doc-section:` lets a section reset paths when opened alone.
- `:flag-doc-section-sub:` provides the same escape hatch for subsections.
Use them to set and restore `:localdir:` and `:imagesdir:` so includes never break.

== Filesystem Structure

.Project layout
[listing]
----
template/
├── README.asciidoc
├── images/
│   └── asciidoc-logic.plantuml
└── section1/
    ├── README.adoc
    ├── images/
    │   └── section1-diagram.plantuml
    ├── subsection1/
    │   ├── README.adoc
    │   └── images/
    │       └── subsection1-diagram.plantuml
    └── subsection2/
        ├── README.adoc
        └── images/
            └── subsection2-diagram.plantuml
└── section2/
    ├── README.adoc
    ├── images/
    │   └── section2-diagram.plantuml
    ├── subsection1/
    │   ├── README.adoc
    │   └── images/
    │       └── subsection1-diagram.plantuml
    └── subsection2/
        ├── README.adoc
        └── images/
            └── subsection2-diagram.plantuml
----

== Automated Testing

`README-tester.sh` is the single command. It walks every README, renders HTML and PDF via `asciidoctor/docker-asciidoctor`, and drops the files under `template/docs/`.

It always:
- Discovers new sections automatically.
- Fails on warnings or non-zero exits.
- Prefers Podman, then Docker, unless you override it.

Typical runs:

.Default behavior (auto-select Podman or Docker)
[source,BASH]
----
./README-tester.sh
----

.Force a specific runtime
[source,BASH]
----
./README-tester.sh --runtime docker
----

.Run Podman through flatpak-spawn on the host
[source,BASH]
----
README_TESTER_RUNTIME_CMD="flatpak-spawn --host podman" ./README-tester.sh
----

Environment overrides documented via `./README-tester.sh --help` let you change the container image or set a custom runtime command for more complex shells.

include::section1/README.adoc[leveloffset=+1]

include::section2/README.adoc[leveloffset=+1]

//
// END OF DOCUMENT
//

// notation appendix
[appendix]
include::includes/book-notation.adoc[leveloffset=+1]

// glossary appendix
[appendix]
== Glossary
include::includes/book-glossary.adoc[]

//copyright at the end
include::includes/book-copyright.adoc[]